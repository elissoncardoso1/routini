import{j as e,d as s}from"./index-D8tfEXww.js";import{r as a}from"./react-vendor-DeomjPLV.js";import{y as o}from"./ui-vendor-DBpOLB1z.js";const t=e=>"string"!=typeof e?"":e.trim().replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").substring(0,1e3),r=e=>null!=e&&("string"==typeof e?e.trim().length>0:!Array.isArray(e)||e.length>0),n=(e,s)=>{const a=[];return s.required&&!r(e)?(a.push(s.message||"Este campo é obrigatório"),{isValid:!1,errors:a}):s.required||r(e)?(s.minLength&&"string"==typeof e&&e.length<s.minLength&&a.push(s.message||`Mínimo de ${s.minLength} caracteres`),s.maxLength&&"string"==typeof e&&e.length>s.maxLength&&a.push(s.message||`Máximo de ${s.maxLength} caracteres`),s.pattern&&"string"==typeof e&&!s.pattern.test(e)&&a.push(s.message||"Formato inválido"),s.custom&&!s.custom(e)&&a.push(s.message||"Valor inválido"),{isValid:0===a.length,errors:a}):{isValid:!0,errors:[]}},i=(e,s)=>{const a=[];let o=!0;for(const[t,r]of Object.entries(s)){const s=e[t],i=n(s,r);i.isValid||(o=!1,a.push(...i.errors.map(e=>`${t}: ${e}`)))}return{isValid:o,errors:a}},l={nome:{required:!0,minLength:2,maxLength:100,message:"Nome deve ter entre 2 e 100 caracteres"},funcao:{required:!0,message:"Função é obrigatória"}},d={nome:{required:!0,minLength:2,maxLength:100,message:"Nome deve ter entre 2 e 100 caracteres"},dataNascimento:{required:!0,custom:e=>(e=>{const s=new Date,a=new Date(1900,0,1),o=new Date(s.getFullYear()+1,11,31);return e>=a&&e<=o})(new Date(e)),message:"Data de nascimento inválida"},diagnostico:{required:!0,minLength:10,maxLength:500,message:"Diagnóstico deve ter entre 10 e 500 caracteres"},"responsavel.nome":{required:!0,minLength:2,maxLength:100,message:"Nome do responsável é obrigatório"},"responsavel.telefone":{required:!0,custom:e=>/^\(\d{2}\) \d{5}-\d{4}$/.test(e),message:"Telefone inválido"},"responsavel.email":{required:!0,custom:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),message:"Email inválido"}};function c({initialData:e,schema:s,onSubmit:o}){const[t,r]=a.useState({data:e,errors:{},isValid:!1,isSubmitting:!1}),n=a.useCallback((e,a)=>{r(o=>{const t={...o.data,[e]:a},r=i(t,s);return{...o,data:t,errors:r.errors.reduce((e,s)=>{const[a]=s.split(": ");return e[a]||(e[a]=[]),e[a].push(s.replace(`${a}: `,"")),e},{}),isValid:r.isValid}})},[s]),l=a.useCallback((e,a)=>{const o=s[e];if(!o)return{isValid:!0,errors:[]};const t=[];return o.required&&(!a||"string"==typeof a&&""===a.trim())&&t.push(o.message||"Este campo é obrigatório"),o.minLength&&"string"==typeof a&&a.length<o.minLength&&t.push(o.message||`Mínimo de ${o.minLength} caracteres`),o.maxLength&&"string"==typeof a&&a.length>o.maxLength&&t.push(o.message||`Máximo de ${o.maxLength} caracteres`),o.pattern&&"string"==typeof a&&!o.pattern.test(a)&&t.push(o.message||"Formato inválido"),{isValid:0===t.length,errors:t}},[s]),d=a.useCallback(async a=>{a&&a.preventDefault(),r(e=>({...e,isSubmitting:!0}));try{const a=i(t.data,s);if(a.isValid)await o(t.data),r({data:e,errors:{},isValid:!1,isSubmitting:!1});else{const e=a.errors.reduce((e,s)=>{const[a]=s.split(": ");return e[a]||(e[a]=[]),e[a].push(s.replace(`${a}: `,"")),e},{});r(s=>({...s,errors:e,isValid:!1,isSubmitting:!1}))}}catch(n){r(e=>({...e,isSubmitting:!1}))}},[t.data,s,o,e]),c=a.useCallback(()=>{r({data:e,errors:{},isValid:!1,isSubmitting:!1})},[e]),m=a.useCallback(e=>t.errors[e]||[],[t.errors]),u=a.useCallback(e=>t.errors[e]&&t.errors[e].length>0,[t.errors]);return{data:t.data,errors:t.errors,isValid:t.isValid,isSubmitting:t.isSubmitting,updateField:n,validateField:l,handleSubmit:d,resetForm:c,getFieldErrors:m,hasFieldError:u}}const m=["Analista do Comportamento","AT","Supervisor Clínico","Psicólogo Clínico","Terapeuta Ocupacional","Fonoaudiólogo","Educador Físico","Musicoterapeuta","Pedagogo","Nutricionista","Médico","Coordenador Clínico","Recepcionista","Estagiário"],u=[{valor:0,nome:"Domingo"},{valor:1,nome:"Segunda"},{valor:2,nome:"Terça"},{valor:3,nome:"Quarta"},{valor:4,nome:"Quinta"},{valor:5,nome:"Sexta"},{valor:6,nome:"Sábado"}],p=["manhã","tarde","noite"];function g({profissional:s,onSave:r,onCancel:n,isOpen:i}){const[d,g]=a.useState([]),x={nome:(null==s?void 0:s.nome)||"",funcao:(null==s?void 0:s.funcao)||"AT",cor:(null==s?void 0:s.cor)||"#3B82F6"},{data:b,isValid:h,isSubmitting:v,updateField:f,handleSubmit:y,getFieldErrors:j,hasFieldError:N}=c({initialData:x,schema:l,onSubmit:async e=>{const a={id:(null==s?void 0:s.id)||crypto.randomUUID(),nome:t(e.nome),funcao:e.funcao,disponibilidade:d,cor:e.cor};r(a)}});a.useEffect(()=>{s&&g(s.disponibilidade)},[s]);const C=(e,s,a)=>{const o=[...d];o[e]={...o[e],[s]:a},g(o)};return e.jsx(o,{open:i,onClose:n,className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx(o.Title,{className:"text-lg font-semibold text-gray-900 mb-4",children:s?"Editar Profissional":"Novo Profissional"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nome",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",id:"nome",value:b.nome,onChange:e=>f("nome",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(N("nome")?"border-red-500":"border-gray-300"),placeholder:"Nome completo"}),j("nome").map((s,a)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s},a))]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"funcao",className:"block text-sm font-medium text-gray-700 mb-1",children:"Função *"}),e.jsx("select",{id:"funcao",value:b.funcao,onChange:e=>f("funcao",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(N("funcao")?"border-red-500":"border-gray-300"),children:m.map(s=>e.jsx("option",{value:s,children:s},s))}),j("funcao").map((s,a)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s},a))]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cor",className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor"}),e.jsx("input",{type:"color",id:"cor",value:b.cor,onChange:e=>f("cor",e.target.value),className:"w-full h-10 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Disponibilidade"}),e.jsxs("div",{className:"space-y-2",children:[d.map((s,a)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("select",{value:s.dia,onChange:e=>C(a,"dia",parseInt(e.target.value)),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:u.map(s=>e.jsx("option",{value:s.valor,children:s.nome},s.valor))}),e.jsx("select",{value:s.turno,onChange:e=>C(a,"turno",e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:p.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("button",{type:"button",onClick:()=>(e=>{g(d.filter((s,a)=>a!==e))})(a),className:"px-3 py-2 text-red-600 hover:text-red-800",children:"Remover"})]},a)),e.jsx("button",{type:"button",onClick:()=>{g([...d,{dia:1,turno:"manhã"}])},className:"px-4 py-2 text-blue-600 hover:text-blue-800 border border-blue-300 rounded-md",children:"+ Adicionar Disponibilidade"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md",disabled:v,children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:!h||v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Salvando...":"Salvar"})]})]})]})})]})})}function x({paciente:r,onSave:n,onCancel:i,isOpen:l}){const[m,u]=a.useState([]),[p,g]=a.useState([]),x={nome:(null==r?void 0:r.nome)||"",dataNascimento:(null==r?void 0:r.dataNascimento)?r.dataNascimento.toISOString().split("T")[0]:"",diagnostico:(null==r?void 0:r.diagnostico)||"","responsavel.nome":(null==r?void 0:r.responsavel.nome)||"","responsavel.telefone":(null==r?void 0:r.responsavel.telefone)||"","responsavel.email":(null==r?void 0:r.responsavel.email)||"",observacoesClinicas:(null==r?void 0:r.observacoesClinicas)||"",status:(null==r?void 0:r.status)||"ativo"},{data:b,isValid:h,isSubmitting:v,updateField:f,handleSubmit:y,getFieldErrors:j,hasFieldError:N}=c({initialData:x,schema:d,onSubmit:async e=>{const s={id:(null==r?void 0:r.id)||crypto.randomUUID(),nome:t(e.nome),dataNascimento:new Date(e.dataNascimento),diagnostico:t(e.diagnostico),responsavel:{nome:t(e["responsavel.nome"]),telefone:(o=e["responsavel.telefone"],o.replace(/\D/g,"").replace(/(\d{2})(\d{5})(\d{4})/,"($1) $2-$3").substring(0,15)),email:(a=e["responsavel.email"],t(a).toLowerCase())},observacoesClinicas:t(e.observacoesClinicas),profissionais:p,status:e.status,tags:(null==r?void 0:r.tags)||[],anotacoesEquipe:(null==r?void 0:r.anotacoesEquipe)||[],foto:null==r?void 0:r.foto,createdAt:(null==r?void 0:r.createdAt)||new Date,updatedAt:new Date};var a,o;n(s)}});a.useEffect(()=>{(async()=>{try{const e=await s.profissionais.toArray();u(e)}catch(e){}})()},[]),a.useEffect(()=>{r&&g(r.profissionais)},[r]);const C=(e,s,a)=>{const o=[...p];o[e]={...o[e],[s]:a},g(o)};return e.jsx(o,{open:l,onClose:i,className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsx(o.Title,{className:"text-lg font-semibold text-gray-900 mb-4",children:r?"Editar Paciente":"Novo Paciente"}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nome",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Completo *"}),e.jsx("input",{type:"text",id:"nome",value:b.nome,onChange:e=>f("nome",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(N("nome")?"border-red-500":"border-gray-300"),placeholder:"Nome completo do paciente"}),j("nome").map((s,a)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s},a))]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dataNascimento",className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Nascimento *"}),e.jsx("input",{type:"date",id:"dataNascimento",value:b.dataNascimento,onChange:e=>f("dataNascimento",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(N("dataNascimento")?"border-red-500":"border-gray-300")}),j("dataNascimento").map((s,a)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"diagnostico",className:"block text-sm font-medium text-gray-700 mb-1",children:"Diagnóstico *"}),e.jsx("textarea",{id:"diagnostico",value:b.diagnostico,onChange:e=>f("diagnostico",e.target.value),rows:3,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(N("diagnostico")?"border-red-500":"border-gray-300"),placeholder:"Descreva o diagnóstico do paciente"}),j("diagnostico").map((s,a)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s},a))]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-3",children:"Responsável"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"responsavelNome",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",id:"responsavelNome",value:b["responsavel.nome"],onChange:e=>f("responsavel.nome",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(N("responsavel.nome")?"border-red-500":"border-gray-300"),placeholder:"Nome do responsável"}),j("responsavel.nome").map((s,a)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s},a))]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"responsavelTelefone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone *"}),e.jsx("input",{type:"tel",id:"responsavelTelefone",value:b["responsavel.telefone"],onChange:e=>f("responsavel.telefone",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(N("responsavel.telefone")?"border-red-500":"border-gray-300"),placeholder:"(11) 99999-9999"}),j("responsavel.telefone").map((s,a)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s},a))]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"responsavelEmail",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",id:"responsavelEmail",value:b["responsavel.email"],onChange:e=>f("responsavel.email",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(N("responsavel.email")?"border-red-500":"border-gray-300"),placeholder:"email@exemplo.com"}),j("responsavel.email").map((s,a)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s},a))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Profissionais"}),e.jsxs("div",{className:"space-y-2",children:[p.map((s,a)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("select",{value:s.id,onChange:e=>C(a,"id",e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione um profissional"}),m.map(s=>e.jsxs("option",{value:s.id,children:[s.nome," - ",s.funcao]},s.id))]}),e.jsxs("select",{value:s.tipo,onChange:e=>C(a,"tipo",e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"AT",children:"AT"}),e.jsx("option",{value:"Fono",children:"Fono"}),e.jsx("option",{value:"TO",children:"TO"}),e.jsx("option",{value:"Psicoterapeuta",children:"Psicoterapeuta"}),e.jsx("option",{value:"Analista do Comportamento",children:"Analista do Comportamento"}),e.jsx("option",{value:"Educador Físico",children:"Educador Físico"})]}),e.jsx("button",{type:"button",onClick:()=>(e=>{g(p.filter((s,a)=>a!==e))})(a),className:"px-3 py-2 text-red-600 hover:text-red-800",children:"Remover"})]},a)),e.jsx("button",{type:"button",onClick:()=>{g([...p,{id:"",tipo:"AT"}])},className:"px-4 py-2 text-blue-600 hover:text-blue-800 border border-blue-300 rounded-md",children:"+ Adicionar Profissional"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"observacoesClinicas",className:"block text-sm font-medium text-gray-700 mb-1",children:"Observações Clínicas"}),e.jsx("textarea",{id:"observacoesClinicas",value:b.observacoesClinicas,onChange:e=>f("observacoesClinicas",e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Observações clínicas adicionais"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{id:"status",value:b.status,onChange:e=>f("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"ativo",children:"Ativo"}),e.jsx("option",{value:"inativo",children:"Inativo"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md",disabled:v,children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:!h||v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Salvando...":"Salvar"})]})]})]})})]})})}export{g as P,x as a};
