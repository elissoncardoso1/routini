import{d as e,j as t,A as o}from"./index-rSdmAoU9.js";import{i as a,a as i,b as r,F as n}from"./calendar-vendor-VSl4A5Hz.js";import{r as s,h as d}from"./react-vendor-DeomjPLV.js";import{t as c}from"./utils-vendor-B_GFmIH5.js";import{y as l}from"./ui-vendor-DBpOLB1z.js";const f={"Psicólogo Clínico":{bg:"#f3e8ff",border:"#9333ea",text:"#581c87",icon:"🩺"},"Fonoaudiólogo":{bg:"#fef3c7",border:"#d97706",text:"#78350f",icon:"👄"},"Terapeuta Ocupacional":{bg:"#dcfce7",border:"#16a34a",text:"#14532d",icon:"🤲"},"Analista do Comportamento":{bg:"#fce7f3",border:"#db2777",text:"#831843",icon:"🎯"},AT:{bg:"#ede9fe",border:"#8b5cf6",text:"#5b21b6",icon:"👥"},"Supervisor Clínico":{bg:"#fef9c3",border:"#ca8a04",text:"#713f12",icon:"👨‍💼"},"Educador Físico":{bg:"#fee2e2",border:"#dc2626",text:"#7f1d1d",icon:"🏃"},Musicoterapeuta:{bg:"#f3f4f6",border:"#4b5563",text:"#1f2937",icon:"🎵"},Pedagogo:{bg:"#d9f99d",border:"#65a30d",text:"#365314",icon:"📚"},Nutricionista:{bg:"#e0f2fe",border:"#0ea5e9",text:"#0c4a6e",icon:"🥗"},"Médico":{bg:"#fee2e2",border:"#dc2626",text:"#7f1d1d",icon:"👨‍⚕️"},"Coordenador Clínico":{bg:"#f5f5f4",border:"#292524",text:"#1c1917",icon:"👨‍💼"},Recepcionista:{bg:"#e0f7fe",border:"#0891b2",text:"#164e63",icon:"👩‍💼"},"Estagiário":{bg:"#f3e8ff",border:"#9333ea",text:"#581c87",icon:"👨‍🎓"}},m={slotMinTime:"07:00:00",slotMaxTime:"20:00:00",height:"calc(100vh - 12rem)",eventMinHeight:60,dayMaxEvents:3,moreLinkText:"mais",allDaySlot:!1,nowIndicator:!0,locale:"pt-br",buttonText:{today:"Hoje",month:"Mês",week:"Semana",day:"Dia"},views:{timeGridDay:{titleFormat:{year:"numeric",month:"long",day:"numeric",weekday:"long"}},timeGridWeek:{titleFormat:{year:"numeric",month:"long"},dayHeaderFormat:{weekday:"short",day:"numeric"}},dayGridMonth:{titleFormat:{year:"numeric",month:"long"},dayHeaderFormat:{weekday:"short"}}},slotLabelFormat:[{hour:"numeric",minute:"2-digit",omitZeroMinute:!1,meridiem:!1}]};function u(){var u;const b=d(),[p,x]=s.useState(!1),[v,g]=s.useState(void 0),h=s.useRef(null),{events:y,loading:w,error:C,loadData:j}=function(){const[t,o]=s.useState([]),[a,i]=s.useState([]),[r,n]=s.useState([]),[d,c]=s.useState(!0),[l,m]=s.useState(null),u=s.useCallback(async()=>{c(!0),m(null);try{const[t,a,r]=await Promise.all([e.profissionais.toArray(),e.pacientes.toArray(),e.atendimentos.toArray()]);i(t),n(a);const s=await Promise.all(r.filter(e=>!e.cancelado).map(async e=>{const o=t.find(t=>t.id===e.profissionalId),i=a.find(t=>t.id===e.pacienteId);if(!o||!i)return null;const r=f[o.funcao];return{id:e.id,title:`${i.nome} - ${o.nome}`,start:e.inicio.toISOString(),end:e.fim.toISOString(),backgroundColor:r.bg,borderColor:r.border,textColor:r.text,profissionalId:o.id,pacienteId:i.id,tipo:o.funcao,observacoes:e.observacoes||"",extendedProps:{tooltip:`${r.icon} ${i.nome}<br><span class="text-gray-500">${o.nome}</span>`,icon:r.icon,profissional:o.nome}}}));o(s.filter(e=>null!==e))}catch(t){m(t instanceof Error?t:new Error("Erro ao carregar dados"))}finally{c(!1)}},[]);s.useEffect(()=>{u()},[u]);const b=s.useCallback(e=>t.find(t=>t.id===e),[t]),p=s.useCallback(e=>({id:e.id,profissionalId:e.profissionalId,pacienteId:e.pacienteId,tipo:e.tipo,inicio:new Date(e.start),fim:new Date(e.end),observacoes:e.observacoes}),[]),x=s.useMemo(()=>{const e=new Map;return t.forEach(t=>{const o=new Date(t.start).toDateString();e.has(o)||e.set(o,[]),e.get(o).push(t)}),e},[t]),v=s.useMemo(()=>{const e=new Map;return t.forEach(t=>{e.has(t.profissionalId)||e.set(t.profissionalId,[]),e.get(t.profissionalId).push(t)}),e},[t]);return{events:t,profissionais:a,pacientes:r,loading:d,error:l,loadData:u,findEventById:b,convertEventToAtendimento:p,eventsByDate:x,eventsByProfissional:v}}(),k=s.useMemo(()=>({...m,plugins:[a,i,r],initialView:"timeGridWeek"}),[]);s.useEffect(()=>{var e;if((null==(e=b.state)?void 0:e.selectedDate)&&h.current){const e=new Date(b.state.selectedDate);h.current.getApi().gotoDate(e)}},[null==(u=b.state)?void 0:u.selectedDate]);const D=s.useCallback(()=>{g(void 0),x(!0)},[]),I=s.useCallback(e=>{const t=y.find(t=>t.id===e.event.id);t&&(g({id:t.id,profissionalId:t.profissionalId,pacienteId:t.pacienteId,tipo:t.tipo,inicio:new Date(t.start),fim:new Date(t.end),observacoes:t.observacoes}),x(!0))},[y]),M=s.useCallback(async()=>{await j(),x(!1)},[j]),S=s.useCallback(()=>{x(!1),g(void 0)},[]),N=s.useCallback(e=>{c(e.el,{content:e.event.extendedProps.tooltip,placement:"top",arrow:!0,theme:"light",allowHTML:!0})},[]),E=s.useCallback(e=>{const o=e.event.extendedProps.icon??"📌",[a,i]=e.event.title.split(" - ");return t.jsxs("div",{className:"h-full w-full px-2 py-1 rounded border-l-4 text-xs leading-tight overflow-hidden shadow-sm",style:{backgroundColor:e.event.backgroundColor??"#f3f4f6",borderLeftColor:e.event.borderColor??"#3b82f6",color:e.event.textColor??"#111827"},children:[t.jsxs("div",{className:"font-semibold truncate flex items-center gap-1",children:[o," ",a]}),t.jsx("div",{className:"text-[11px] text-gray-700 truncate",children:i})]})},[]);return w?t.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-12rem)]",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"})}):C?t.jsxs("div",{className:"flex items-center justify-center h-[calc(100vh-12rem)] text-red-500",children:["Erro ao carregar dados: ",C.message]}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[t.jsx(n,{ref:h,...k,events:y,eventDidMount:N,eventContent:E,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},dateClick:D,eventClick:I}),t.jsx(l,{open:p,onClose:S,className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30"}),t.jsx("div",{className:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:t.jsxs("div",{className:"p-6",children:[t.jsx(l.Title,{className:"text-lg font-semibold text-gray-900 mb-4",children:v?"Editar Atendimento":"Novo Atendimento"}),t.jsx(o,{atendimento:v,onSave:M,onCancel:S})]})})]})})]})}export{u as Calendar};
