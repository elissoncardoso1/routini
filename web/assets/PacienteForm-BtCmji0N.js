import{j as e,d as a}from"./index-BTVIKfVS.js";import{r as s}from"./react-vendor-DeomjPLV.js";import{y as o}from"./ui-vendor-DBpOLB1z.js";const r=e=>"string"!=typeof e?"":e.trim().replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").substring(0,1e3),t=e=>null!=e&&("string"==typeof e?e.trim().length>0:!Array.isArray(e)||e.length>0),n=(e,a)=>{const s=[];return a.required&&!t(e)?(s.push(a.message||"Este campo é obrigatório"),{isValid:!1,errors:s}):a.required||t(e)?(a.minLength&&"string"==typeof e&&e.length<a.minLength&&s.push(a.message||`Mínimo de ${a.minLength} caracteres`),a.maxLength&&"string"==typeof e&&e.length>a.maxLength&&s.push(a.message||`Máximo de ${a.maxLength} caracteres`),a.pattern&&"string"==typeof e&&!a.pattern.test(e)&&s.push(a.message||"Formato inválido"),a.custom&&!a.custom(e)&&s.push(a.message||"Valor inválido"),{isValid:0===s.length,errors:s}):{isValid:!0,errors:[]}},i=(e,a)=>{const s=[];let o=!0;for(const[r,t]of Object.entries(a)){const a=e[r],i=n(a,t);i.isValid||(o=!1,s.push(...i.errors.map(e=>`${r}: ${e}`)))}return{isValid:o,errors:s}},l={nome:{required:!0,minLength:2,maxLength:100,message:"Nome deve ter entre 2 e 100 caracteres"},funcao:{required:!0,message:"Função é obrigatória"}},d={nome:{required:!0,minLength:2,maxLength:100,message:"Nome deve ter entre 2 e 100 caracteres"},dataNascimento:{required:!0,custom:e=>(e=>{const a=new Date,s=new Date(1900,0,1),o=new Date(a.getFullYear()+1,11,31);return e>=s&&e<=o})(new Date(e)),message:"Data de nascimento inválida"},diagnostico:{required:!0,minLength:10,maxLength:500,message:"Diagnóstico deve ter entre 10 e 500 caracteres"},"responsavel.nome":{required:!0,minLength:2,maxLength:100,message:"Nome do responsável é obrigatório"},"responsavel.telefone":{required:!0,custom:e=>/^\(\d{2}\) \d{5}-\d{4}$/.test(e),message:"Telefone inválido"},"responsavel.email":{required:!0,custom:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),message:"Email inválido"}};function c({initialData:e,schema:a,onSubmit:o}){const[r,t]=s.useState({data:e,errors:{},isValid:!1,isSubmitting:!1}),n=s.useCallback((e,s)=>{t(o=>{const r={...o.data,[e]:s},t=i(r,a);return{...o,data:r,errors:t.errors.reduce((e,a)=>{const[s]=a.split(": ");return e[s]||(e[s]=[]),e[s].push(a.replace(`${s}: `,"")),e},{}),isValid:t.isValid}})},[a]),l=s.useCallback((e,s)=>{const o=a[e];if(!o)return{isValid:!0,errors:[]};const r=[];return o.required&&(!s||"string"==typeof s&&""===s.trim())&&r.push(o.message||"Este campo é obrigatório"),o.minLength&&"string"==typeof s&&s.length<o.minLength&&r.push(o.message||`Mínimo de ${o.minLength} caracteres`),o.maxLength&&"string"==typeof s&&s.length>o.maxLength&&r.push(o.message||`Máximo de ${o.maxLength} caracteres`),o.pattern&&"string"==typeof s&&!o.pattern.test(s)&&r.push(o.message||"Formato inválido"),{isValid:0===r.length,errors:r}},[a]),d=s.useCallback(async s=>{s&&s.preventDefault(),t(e=>({...e,isSubmitting:!0}));try{const s=i(r.data,a);if(s.isValid)await o(r.data),t({data:e,errors:{},isValid:!1,isSubmitting:!1});else{const e=s.errors.reduce((e,a)=>{const[s]=a.split(": ");return e[s]||(e[s]=[]),e[s].push(a.replace(`${s}: `,"")),e},{});t(a=>({...a,errors:e,isValid:!1,isSubmitting:!1}))}}catch(n){t(e=>({...e,isSubmitting:!1}))}},[r.data,a,o,e]),c=s.useCallback(()=>{t({data:e,errors:{},isValid:!1,isSubmitting:!1})},[e]),m=s.useCallback(e=>r.errors[e]||[],[r.errors]),u=s.useCallback(e=>r.errors[e]&&r.errors[e].length>0,[r.errors]);return{data:r.data,errors:r.errors,isValid:r.isValid,isSubmitting:r.isSubmitting,updateField:n,validateField:l,handleSubmit:d,resetForm:c,getFieldErrors:m,hasFieldError:u}}const m=["Analista do Comportamento","AT","Supervisor Clínico","Psicólogo Clínico","Terapeuta Ocupacional","Fonoaudiólogo","Educador Físico","Musicoterapeuta","Pedagogo","Nutricionista","Médico","Coordenador Clínico","Recepcionista","Estagiário"],u=[{valor:0,nome:"Domingo"},{valor:1,nome:"Segunda"},{valor:2,nome:"Terça"},{valor:3,nome:"Quarta"},{valor:4,nome:"Quinta"},{valor:5,nome:"Sexta"},{valor:6,nome:"Sábado"}],p=["manhã","tarde","noite"];function g({profissional:a,onSave:t,onCancel:n,isOpen:i}){const[d,g]=s.useState([]),x={nome:(null==a?void 0:a.nome)||"",funcao:(null==a?void 0:a.funcao)||"AT",cor:(null==a?void 0:a.cor)||"#3B82F6"},{data:h,isValid:v,isSubmitting:b,updateField:f,handleSubmit:y,getFieldErrors:j,hasFieldError:N}=c({initialData:x,schema:l,onSubmit:async e=>{const s={id:(null==a?void 0:a.id)||crypto.randomUUID(),nome:r(e.nome),funcao:e.funcao,disponibilidade:d,cor:e.cor};t(s)}});s.useEffect(()=>{a&&g(a.disponibilidade)},[a]);const C=(e,a,s)=>{const o=[...d];o[e]={...o[e],[a]:s},g(o)};return e.jsx(o,{open:i,onClose:n,className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx(o.Title,{className:"text-lg font-semibold text-gray-900 mb-4",children:a?"Editar Profissional":"Novo Profissional"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nome",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",id:"nome",value:h.nome,onChange:e=>f("nome",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 "+(N("nome")?"border-red-500":"border-gray-300"),placeholder:"Nome completo"}),j("nome").map((a,s)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a},s))]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"funcao",className:"block text-sm font-medium text-gray-700 mb-1",children:"Função *"}),e.jsx("select",{id:"funcao",value:h.funcao,onChange:e=>f("funcao",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 "+(N("funcao")?"border-red-500":"border-gray-300"),children:m.map(a=>e.jsx("option",{value:a,children:a},a))}),j("funcao").map((a,s)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a},s))]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cor",className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor"}),e.jsx("input",{type:"color",id:"cor",value:h.cor,onChange:e=>f("cor",e.target.value),className:"w-full h-10 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Disponibilidade"}),e.jsxs("div",{className:"space-y-2",children:[d.map((a,s)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("select",{value:a.dia,onChange:e=>C(s,"dia",parseInt(e.target.value)),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:u.map(a=>e.jsx("option",{value:a.valor,children:a.nome},a.valor))}),e.jsx("select",{value:a.turno,onChange:e=>C(s,"turno",e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:p.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("button",{type:"button",onClick:()=>(e=>{g(d.filter((a,s)=>s!==e))})(s),className:"px-3 py-2 text-red-600 hover:text-red-800",children:"Remover"})]},s)),e.jsx("button",{type:"button",onClick:()=>{g([...d,{dia:1,turno:"manhã"}])},className:"px-4 py-2 text-primary-500 hover:text-primary-600 border border-primary-300 rounded-md",children:"+ Adicionar Disponibilidade"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md",disabled:b,children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:!v||b,className:"px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Salvando...":"Salvar"})]})]})]})})]})})}function x({paciente:t,onSave:n,onCancel:i,isOpen:l}){const[m,u]=s.useState([]),[p,g]=s.useState([]),x={nome:(null==t?void 0:t.nome)||"",dataNascimento:(null==t?void 0:t.dataNascimento)?t.dataNascimento.toISOString().split("T")[0]:"",diagnostico:(null==t?void 0:t.diagnostico)||"","responsavel.nome":(null==t?void 0:t.responsavel.nome)||"","responsavel.telefone":(null==t?void 0:t.responsavel.telefone)||"","responsavel.email":(null==t?void 0:t.responsavel.email)||"",observacoesClinicas:(null==t?void 0:t.observacoesClinicas)||"",status:(null==t?void 0:t.status)||"ativo"},{data:h,isValid:v,isSubmitting:b,updateField:f,handleSubmit:y,getFieldErrors:j,hasFieldError:N}=c({initialData:x,schema:d,onSubmit:async e=>{const a={id:(null==t?void 0:t.id)||crypto.randomUUID(),nome:r(e.nome),dataNascimento:new Date(e.dataNascimento),diagnostico:r(e.diagnostico),responsavel:{nome:r(e["responsavel.nome"]),telefone:(o=e["responsavel.telefone"],o.replace(/\D/g,"").replace(/(\d{2})(\d{5})(\d{4})/,"($1) $2-$3").substring(0,15)),email:(s=e["responsavel.email"],r(s).toLowerCase())},observacoesClinicas:r(e.observacoesClinicas),profissionais:p,status:e.status,tags:(null==t?void 0:t.tags)||[],anotacoesEquipe:(null==t?void 0:t.anotacoesEquipe)||[],foto:null==t?void 0:t.foto,createdAt:(null==t?void 0:t.createdAt)||new Date,updatedAt:new Date};var s,o;n(a)}});s.useEffect(()=>{(async()=>{try{const e=await a.profissionais.toArray();u(e)}catch(e){}})()},[]),s.useEffect(()=>{t&&g(t.profissionais)},[t]);const C=(e,a,s)=>{const o=[...p];o[e]={...o[e],[a]:s},g(o)};return e.jsx(o,{open:l,onClose:i,className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsx(o.Title,{className:"text-lg font-semibold text-gray-900 mb-4",children:t?"Editar Paciente":"Novo Paciente"}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nome",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Completo *"}),e.jsx("input",{type:"text",id:"nome",value:h.nome,onChange:e=>f("nome",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 "+(N("nome")?"border-red-500":"border-gray-300"),placeholder:"Nome completo do paciente"}),j("nome").map((a,s)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a},s))]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dataNascimento",className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Nascimento *"}),e.jsx("input",{type:"date",id:"dataNascimento",value:h.dataNascimento,onChange:e=>f("dataNascimento",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 "+(N("dataNascimento")?"border-red-500":"border-gray-300")}),j("dataNascimento").map((a,s)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"diagnostico",className:"block text-sm font-medium text-gray-700 mb-1",children:"Diagnóstico *"}),e.jsx("textarea",{id:"diagnostico",value:h.diagnostico,onChange:e=>f("diagnostico",e.target.value),rows:3,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 "+(N("diagnostico")?"border-red-500":"border-gray-300"),placeholder:"Descreva o diagnóstico do paciente"}),j("diagnostico").map((a,s)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a},s))]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-3",children:"Responsável"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"responsavelNome",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",id:"responsavelNome",value:h["responsavel.nome"],onChange:e=>f("responsavel.nome",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 "+(N("responsavel.nome")?"border-red-500":"border-gray-300"),placeholder:"Nome do responsável"}),j("responsavel.nome").map((a,s)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a},s))]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"responsavelTelefone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone *"}),e.jsx("input",{type:"tel",id:"responsavelTelefone",value:h["responsavel.telefone"],onChange:e=>f("responsavel.telefone",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 "+(N("responsavel.telefone")?"border-red-500":"border-gray-300"),placeholder:"(11) 99999-9999"}),j("responsavel.telefone").map((a,s)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a},s))]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"responsavelEmail",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",id:"responsavelEmail",value:h["responsavel.email"],onChange:e=>f("responsavel.email",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 "+(N("responsavel.email")?"border-red-500":"border-gray-300"),placeholder:"email@exemplo.com"}),j("responsavel.email").map((a,s)=>e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Profissionais"}),e.jsxs("div",{className:"space-y-2",children:[p.map((a,s)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("select",{value:a.id,onChange:e=>C(s,"id",e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Selecione um profissional"}),m.map(a=>e.jsxs("option",{value:a.id,children:[a.nome," - ",a.funcao]},a.id))]}),e.jsxs("select",{value:a.tipo,onChange:e=>C(s,"tipo",e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"AT",children:"AT"}),e.jsx("option",{value:"Fono",children:"Fono"}),e.jsx("option",{value:"TO",children:"TO"}),e.jsx("option",{value:"Psicoterapeuta",children:"Psicoterapeuta"}),e.jsx("option",{value:"Analista do Comportamento",children:"Analista do Comportamento"}),e.jsx("option",{value:"Educador Físico",children:"Educador Físico"})]}),e.jsx("button",{type:"button",onClick:()=>(e=>{g(p.filter((a,s)=>s!==e))})(s),className:"px-3 py-2 text-red-600 hover:text-red-800",children:"Remover"})]},s)),e.jsx("button",{type:"button",onClick:()=>{g([...p,{id:"",tipo:"AT"}])},className:"px-4 py-2 text-primary-500 hover:text-primary-600 border border-primary-300 rounded-md",children:"+ Adicionar Profissional"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"observacoesClinicas",className:"block text-sm font-medium text-gray-700 mb-1",children:"Observações Clínicas"}),e.jsx("textarea",{id:"observacoesClinicas",value:h.observacoesClinicas,onChange:e=>f("observacoesClinicas",e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Observações clínicas adicionais"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{id:"status",value:h.status,onChange:e=>f("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"ativo",children:"Ativo"}),e.jsx("option",{value:"inativo",children:"Inativo"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md",disabled:b,children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:!v||b,className:"px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Salvando...":"Salvar"})]})]})]})})]})})}export{g as P,x as a};
